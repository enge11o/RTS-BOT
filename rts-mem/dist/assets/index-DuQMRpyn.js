(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();const W={fromPoints(s,e){const t=Math.min(s.x,e.x),i=Math.min(s.y,e.y);return{x:t,y:i,w:Math.abs(s.x-e.x),h:Math.abs(s.y-e.y)}},contains(s,e){return e.x>=s.x&&e.y>=s.y&&e.x<=s.x+s.w&&e.y<=s.y+s.h},intersectsCircle(s,e,t){const i=Math.max(s.x,Math.min(e.x,s.x+s.w)),o=Math.max(s.y,Math.min(e.y,s.y+s.h)),n=e.x-i,a=e.y-o;return n*n+a*a<=t*t}};class Q{width;height;nodes;constructor(e,t){this.width=e,this.height=t,this.nodes=new Array(e*t).fill(0).map((i,o)=>({x:o%e,y:Math.floor(o/e),walkable:!0}))}idx(e,t){return t*this.width+e}inBounds(e,t){return e>=0&&t>=0&&e<this.width&&t<this.height}setBlocked(e,t,i){this.inBounds(e,t)&&(this.nodes[this.idx(e,t)].walkable=!i)}isWalkable(e,t){return this.inBounds(e,t)&&this.nodes[this.idx(e,t)].walkable}}function X(s,e,t){const i=Math.round(e.x),o=Math.round(e.y),n=Math.round(t.x),a=Math.round(t.y);if(!s.inBounds(i,o)||!s.inBounds(n,a))return[];const c=[],h=new Map,f=new Map,b=new Map,k=s.idx(i,o);c.push(k),f.set(k,0),b.set(k,C(i,o,n,a));const B=new Set;for(;c.length;){let E=0;for(let r=1;r<c.length;r++)(b.get(c[r])??1/0)<(b.get(c[E])??1/0)&&(E=r);const l=c.splice(E,1)[0];if(l===s.idx(n,a))return Y(s,h,l);B.add(l);const P=l%s.width,R=Math.floor(l/s.width);for(const[r,x]of F(s,P,R)){const d=s.idx(r,x);if(B.has(d)||!s.isWalkable(r,x))continue;const v=(f.get(l)??1/0)+G(P,R,r,x);if(!c.includes(d))c.push(d);else if(v>=(f.get(d)??1/0))continue;h.set(d,l),f.set(d,v),b.set(d,v+C(r,x,n,a))}}return[]}function Y(s,e,t){const i=[];for(;e.has(t);){const o=t%s.width,n=Math.floor(t/s.width);i.push({x:o,y:n}),t=e.get(t)}return i.reverse(),i.length>1&&q(i),i}function F(s,e,t){const i=[];for(let o=-1;o<=1;o++)for(let n=-1;n<=1;n++){if(n===0&&o===0)continue;const a=e+n,c=t+o;s.inBounds(a,c)&&s.isWalkable(a,c)&&(n!==0&&o!==0&&(!s.isWalkable(e+n,t)||!s.isWalkable(e,t+o))||i.push([a,c]))}return i}function C(s,e,t,i){const o=Math.abs(s-t),n=Math.abs(e-i);return o+n+(Math.SQRT2-2)*Math.min(o,n)}function G(s,e,t,i){return Math.hypot(t-s,i-e)}function q(s){for(let e=s.length-3;e>=0;e--){const t=s[e],i=s[e+1],o=s[e+2],n=i.x-t.x,a=i.y-t.y,c=o.x-i.x,h=o.y-i.y;n===c&&a===h&&s.splice(e+1,1)}}let w=1;class ${width;height;tileSize=16;nav;entities=[];effects=[];economy={rubles:500,dollars:200};time=0;objectiveText="Песочница";onUpdateExtra;winCondition;loseCondition;catalog={"sbeu-worker":{id:"sbeu-worker",label:"Дикий (рабочий)",costRubles:50,costDollars:0,buildTime:4,tier:1},"sbeu-worm":{id:"sbeu-worm",label:"СБЭУ-Червь",costRubles:50,costDollars:0,buildTime:6,tier:1},"sbeu-caterpillar":{id:"sbeu-caterpillar",label:"СБЭУ-Гусеница",costRubles:75,costDollars:0,buildTime:7,tier:1},"sbeu-cockroach":{id:"sbeu-cockroach",label:"СБЭУ-Таракан",costRubles:125,costDollars:25,buildTime:10,tier:2},"sbeu-cicada":{id:"sbeu-cicada",label:"СБЭУ-Цикада",costRubles:100,costDollars:50,buildTime:12,tier:2},"sbeu-turtle":{id:"sbeu-turtle",label:"СБЭУ-Черепаха",costRubles:250,costDollars:100,buildTime:20,tier:3},"pmc-typok":{id:"pmc-typok",label:"Типок",costRubles:50,costDollars:0,buildTime:6,tier:1},"pmc-silach":{id:"pmc-silach",label:"Силач",costRubles:100,costDollars:0,buildTime:9,tier:2},"pmc-sniper":{id:"pmc-sniper",label:"Снайпер",costRubles:125,costDollars:50,buildTime:12,tier:2},"pmc-grenade":{id:"pmc-grenade",label:"Грената",costRubles:100,costDollars:75,buildTime:14,tier:2},"pmc-tank":{id:"pmc-tank",label:"Танк",costRubles:300,costDollars:150,buildTime:25,tier:3}};constructor(e,t){this.width=e,this.height=t,this.nav=new Q(e,t)}blockTilesForCircle(e,t){const i=Math.ceil(t);for(let o=-i;o<=i;o++)for(let n=-i;n<=i;n++){const a=Math.floor(e.x+n),c=Math.floor(e.y+o);n*n+o*o<=i*i&&this.nav.setBlocked(a,c,!0)}}spawnDemo(){const e={id:w++,name:"Улей",type:"building",faction:"SBEU",pos:{x:40,y:40},radius:6,hp:1500,hpMax:1500,tier:1,trainQueue:[],garrison:0};this.entities.push(e),this.blockTilesForCircle(e.pos,e.radius+1);for(let i=0;i<6;i++)this.spawnUnit("SBEU",{x:52+i*2,y:40},"sbeu-worker");for(let i=0;i<12;i++){const o=this.spawnResource({x:70+i%6*3,y:32+Math.floor(i/6)*3},"rubles",1500);this.blockTilesForCircle(o.pos,o.radius+1)}for(let i=0;i<8;i++){const o=this.spawnResource({x:64+i%4*3,y:48+Math.floor(i/4)*3},"dollars",800);this.blockTilesForCircle(o.pos,o.radius+1)}const t={id:w++,name:"Центр поставок",type:"building",faction:"PMС",pos:{x:96,y:88},radius:6,hp:1400,hpMax:1400,tier:1,trainQueue:[],garrison:0};this.entities.push(t),this.blockTilesForCircle(t.pos,t.radius+1);for(let i=0;i<4;i++)this.spawnUnit("PMС",{x:90+i*2,y:96},"pmc-typok");this.objectiveText="Песочница: стройте юнитов и тестируйте управление"}spawnResource(e,t,i){const o={id:w++,name:t==="rubles"?"Рубли":"Доллары",type:"resource",faction:"NEUTRAL",pos:e,radius:3,hp:1,hpMax:1,resource:{kind:t,amount:i}};return this.entities.push(o),o}spawnUnit(e,t,i){const o=this.catalog[i],n={id:w++,name:o.label,type:"unit",faction:e,pos:{...t},radius:2.8,hp:100,hpMax:100,moveSpeed:7,attack:{range:8,damage:6,cooldown:1,cd:0}};return(i==="sbeu-turtle"||i==="pmc-tank")&&(n.radius=4,n.hp=260,n.hpMax=260,n.moveSpeed=4,n.attack={range:10,damage:14,cooldown:1.5,cd:0},i==="pmc-tank"&&(n.attack.splash=2.5)),i==="pmc-sniper"&&(n.attack={range:16,damage:6,cooldown:1.2,cd:0},n.abilities={aimedShot:{cd:0,cooldown:5,bonusDamage:30}}),i==="pmc-grenade"&&(n.attack={range:10,damage:4,cooldown:2,cd:0},n.abilities={throwGrenade:{cd:0,cooldown:10,fuse:2,radius:3,damage:32,range:12}}),i==="sbeu-cicada"&&(n.attack={range:9,damage:3,cooldown:1,cd:0},n.abilities={stunGrenade:{cd:0,cooldown:12,radius:3.5,duration:2.5,range:11}}),this.entities.push(n),n}getEntityById(e){return this.entities.find(t=>t.id===e)}queryEntities(e){const t=[];for(const i of this.entities)i.type!=="resource"&&W.intersectsCircle(e,i.pos,i.radius)&&t.push(i.id);return t}pickEntity(e,t){for(let i=this.entities.length-1;i>=0;i--){const o=this.entities[i],n=e-o.pos.x,a=t-o.pos.y;if(n*n+a*a<=o.radius*o.radius)return o}return null}issueMoveCommand(e,t){const i={x:Math.floor(t.x),y:Math.floor(t.y)};for(const o of e){const n=this.getEntityById(o);if(!n||n.type!=="unit"||!n.moveSpeed)continue;const a={x:Math.floor(n.pos.x),y:Math.floor(n.pos.y)},c=X(this.nav,a,i);n.path=c,n.pathIndex=0,n.targetPos={...t}}}getEconomy(){return this.economy}getTrainableUnits(e,t){const i=[];for(const o of Object.values(this.catalog))o.id.startsWith("sbeu")&&e!=="SBEU"||o.id.startsWith("pmc")&&e!=="PMС"||t&&o.tier>t||i.push(o);return i}queueTrain(e,t){const i=this.getEntityById(e);if(!i||i.type!=="building")return;const o=this.catalog[t];o&&(this.economy.rubles<o.costRubles||this.economy.dollars<o.costDollars||(this.economy.rubles-=o.costRubles,this.economy.dollars-=o.costDollars,i.trainQueue=i.trainQueue||[],i.trainQueue.push(t)))}processTraining(e){for(const t of this.entities){if(t.type!=="building"||!t.trainQueue||t.trainQueue.length===0)continue;const i=t.trainQueue[0],o=this.catalog[i];t.garrison=(t.garrison??0)+e,t.garrison>=o.buildTime&&(t.garrison=0,t.trainQueue.shift(),this.spawnUnit(t.faction,{x:t.pos.x+8+Math.random()*4,y:t.pos.y+(Math.random()*6-3)},i))}}harvestAndIncome(e){for(const t of this.entities){if(t.type==="unit"&&t.faction==="SBEU"&&t.name.includes("Дикий")){const i=this.entities.find(o=>o.type==="resource"&&o.resource?.kind==="rubles"&&m(t.pos,o.pos)<10&&o.resource.amount>0);i&&(this.economy.rubles+=2*e,i.resource.amount=Math.max(0,i.resource.amount-3*e))}t.type==="building"&&t.faction==="PMС"&&t.name.includes("Центр поставок")&&(this.economy.dollars+=3*e)}}updateEffects(e){for(const i of this.effects)i.fuse-=e;const t=this.effects.filter(i=>i.fuse<=0);this.effects=this.effects.filter(i=>i.fuse>0);for(const i of t)if(i.kind==="explosion")for(const o of this.entities)o.faction===i.faction||o.faction==="NEUTRAL"||m(o.pos,i.pos)<=i.radius&&(o.hp-=i.damage);else if(i.kind==="stun")for(const o of this.entities)o.faction!=="NEUTRAL"&&m(o.pos,i.pos)<=i.radius&&(o.stunnedUntil=Math.max(o.stunnedUntil??0,this.time+i.duration))}useAbilities(e){for(const t of this.entities){if(t.type!=="unit"||!t.abilities||(t.stunnedUntil??0)>this.time)continue;const i=this.entities.find(n=>n.faction!==t.faction&&n.faction!=="NEUTRAL"&&n.hp>0);if(!i)continue;const o=m(t.pos,i.pos);if(t.abilities.stunGrenade){const n=t.abilities.stunGrenade;n.cd=Math.max(0,n.cd-e),n.cd===0&&o<=n.range&&(this.effects.push({kind:"stun",pos:{...i.pos},fuse:.1,radius:n.radius,duration:n.duration}),n.cd=n.cooldown)}if(t.abilities.aimedShot){const n=t.abilities.aimedShot;n.cd=Math.max(0,n.cd-e),n.cd===0&&t.attack&&o<=t.attack.range&&(i.hp-=n.bonusDamage,n.cd=n.cooldown)}if(t.abilities.throwGrenade){const n=t.abilities.throwGrenade;n.cd=Math.max(0,n.cd-e),n.cd===0&&o<=n.range&&(this.effects.push({kind:"explosion",pos:{...i.pos},fuse:n.fuse,radius:n.radius,damage:n.damage,faction:t.faction}),n.cd=n.cooldown)}}}update(e){this.time+=e;for(const t of this.entities)if(!(t.type!=="unit"||!t.moveSpeed)&&!((t.stunnedUntil??0)>this.time)&&t.path&&t.pathIndex<t.path.length){const i=t.path[t.pathIndex],o={x:i.x,y:i.y},n=o.x-t.pos.x,a=o.y-t.pos.y,c=Math.hypot(n,a);if(c<.2)t.pathIndex++;else{const h=n/(c||1),f=a/(c||1);t.pos.x+=h*t.moveSpeed*e,t.pos.y+=f*t.moveSpeed*e}}this.useAbilities(e);for(const t of this.entities){if(!t.attack)continue;if((t.stunnedUntil??0)>this.time){t.attack.cd=Math.max(0,t.attack.cd-e);continue}t.attack.cd=Math.max(0,t.attack.cd-e);const i=this.entities.find(o=>o.faction!==t.faction&&o.faction!=="NEUTRAL"&&o.hp>0&&m(t.pos,o.pos)<=t.attack.range);if(i&&t.attack.cd<=0){if(i.hp-=t.attack.damage,t.attack.splash)for(const o of this.entities){if(o===i||o.faction===t.faction||o.faction==="NEUTRAL")continue;m(o.pos,i.pos)<=t.attack.splash&&(o.hp-=Math.max(1,Math.floor(t.attack.damage*.4)))}t.attack.cd=t.attack.cooldown}}this.updateEffects(e),this.entities=this.entities.filter(t=>t.hp>0||t.type==="resource"),this.processTraining(e),this.harvestAndIncome(e),this.onUpdateExtra&&this.onUpdateExtra(this,e)}render(e){e.save(),e.strokeStyle="#0f172a",e.lineWidth=1;for(let t=0;t<=this.height;t+=8)e.beginPath(),e.moveTo(0,t),e.lineTo(this.width,t),e.stroke();for(let t=0;t<=this.width;t+=8)e.beginPath(),e.moveTo(t,0),e.lineTo(t,this.height),e.stroke();for(const t of this.effects)t.kind==="explosion"?(e.strokeStyle="rgba(239,68,68,0.6)",e.beginPath(),e.arc(t.pos.x,t.pos.y,t.radius,0,Math.PI*2),e.stroke()):t.kind==="stun"&&(e.strokeStyle="rgba(96,165,250,0.6)",e.beginPath(),e.arc(t.pos.x,t.pos.y,t.radius,0,Math.PI*2),e.stroke());for(const t of this.entities)t.type==="resource"&&(e.fillStyle=t.resource.kind==="rubles"?"#3b82f6":"#22c55e",e.beginPath(),e.arc(t.pos.x,t.pos.y,2.5,0,Math.PI*2),e.fill());for(const t of this.entities)t.type==="building"&&(e.fillStyle=t.faction==="SBEU"?"#9333ea":"#ef4444",e.fillRect(t.pos.x-6,t.pos.y-6,12,12),D(e,t));for(const t of this.entities)if(t.type==="unit"){const i=(t.stunnedUntil??0)>this.time;e.fillStyle=t.faction==="SBEU"?"#a78bfa":"#f87171",e.globalAlpha=i?.6:1,e.beginPath(),e.arc(t.pos.x,t.pos.y,t.radius,0,Math.PI*2),e.fill(),e.globalAlpha=1,D(e,t)}e.restore()}}function D(s,e){const o=e.pos.x-6,n=e.pos.y-(e.type==="building"?8:e.radius+6);s.fillStyle="#111827",s.fillRect(o,n,12,2);const a=Math.max(0,Math.min(1,e.hp/e.hpMax));s.fillStyle=a>.6?"#22c55e":a>.3?"#eab308":"#ef4444",s.fillRect(o,n,12*a,2)}function m(s,e){return Math.hypot(s.x-e.x,s.y-e.y)}class O{canvas;ctx;world;camera={x:0,y:0,zoom:1};mouse={x:0,y:0,worldX:0,worldY:0,down:!1};selectionStart=null;selectedIds=new Set;constructor(e,t){this.canvas=e,this.ctx=t,this.world=new $(128,128),this.world.spawnDemo(),this.bindInput()}loadWorld(e){this.world=e,this.selectedIds.clear(),this.camera={x:0,y:0,zoom:1}}bindInput(){this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect();this.mouse.x=e.clientX-t.left,this.mouse.y=e.clientY-t.top,this.mouse.worldX=this.mouse.x/this.camera.zoom+this.camera.x,this.mouse.worldY=this.mouse.y/this.camera.zoom+this.camera.y}),this.canvas.addEventListener("mousedown",e=>{e.button===0&&(this.mouse.down=!0,this.selectionStart={x:this.mouse.worldX,y:this.mouse.worldY})}),window.addEventListener("mouseup",e=>{e.button===0&&(this.mouse.down=!1,this.commitSelection(),this.selectionStart=null)}),this.canvas.addEventListener("contextmenu",e=>e.preventDefault()),this.canvas.addEventListener("mouseup",e=>{if(e.button===2){const t={x:this.mouse.worldX,y:this.mouse.worldY};this.world.issueMoveCommand([...this.selectedIds],t)}}),window.addEventListener("keydown",e=>{(e.key==="ArrowUp"||e.key==="w")&&(this.camera.y-=32),(e.key==="ArrowDown"||e.key==="s")&&(this.camera.y+=32),(e.key==="ArrowLeft"||e.key==="a")&&(this.camera.x-=32),(e.key==="ArrowRight"||e.key==="d")&&(this.camera.x+=32)}),this.canvas.addEventListener("wheel",e=>{const t=e.deltaY>0?.9:1.1,i=this.screenToWorld(this.mouse.x,this.mouse.y);this.camera.zoom=Math.max(.5,Math.min(2,this.camera.zoom*t));const o=this.screenToWorld(this.mouse.x,this.mouse.y);this.camera.x+=i.x-o.x,this.camera.y+=i.y-o.y},{passive:!0})}screenToWorld(e,t){return{x:e/this.camera.zoom+this.camera.x,y:t/this.camera.zoom+this.camera.y}}commitSelection(){if(!this.selectionStart){const i=this.world.pickEntity(this.mouse.worldX,this.mouse.worldY);this.selectedIds.clear(),i&&this.selectedIds.add(i.id);return}const e=W.fromPoints(this.selectionStart,{x:this.mouse.worldX,y:this.mouse.worldY}),t=this.world.queryEntities(e);this.selectedIds=new Set(t)}update(e){this.world.update(e)}render(){const{ctx:e}=this;if(e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.scale(this.camera.zoom,this.camera.zoom),e.translate(-this.camera.x,-this.camera.y),this.world.render(e),this.mouse.down&&this.selectionStart){const t=Math.min(this.selectionStart.x,this.mouse.worldX),i=Math.min(this.selectionStart.y,this.mouse.worldY),o=Math.abs(this.selectionStart.x-this.mouse.worldX),n=Math.abs(this.selectionStart.y-this.mouse.worldY);e.strokeStyle="#60a5fa",e.lineWidth=1,e.strokeRect(t,i,o,n)}for(const t of this.selectedIds){const i=this.world.getEntityById(t);i&&(e.strokeStyle="#34d399",e.lineWidth=2,e.beginPath(),e.arc(i.pos.x,i.pos.y,i.radius+2,0,Math.PI*2),e.stroke())}e.restore()}getUIState(){const e=this.world.getEconomy(),t=[...this.selectedIds].map(n=>this.world.getEntityById(n)).filter(Boolean),i=t.length===1?`${t[0].name} (HP ${Math.ceil(t[0].hp)})`:t.length>1?`${t.length} юнитов`:"—",o=[];if(t.length===1&&t[0].type==="building"){const n=t[0];for(const a of this.world.getTrainableUnits(n.faction,n.tier))o.push({id:`train:${a.id}`,label:`Нанять ${a.label}`,costRubles:a.costRubles,costDollars:a.costDollars,onClick:()=>this.world.queueTrain(n.id,a.id)})}return{rubles:e.rubles,dollars:e.dollars,selectedCount:t.length,inspector:i,objective:this.world.objectiveText,actions:o}}}function u(s,e,t,i){for(const o of i)for(let n=0;n<o.count;n++)s.spawnUnit(e,{x:t.x+(Math.random()*6-3),y:t.y+(Math.random()*6-3)},o.unitId)}function S(s,e){s.objectiveText="Уничтожьте все силы противника",s.winCondition=t=>t.entities.every(i=>i.faction===e||i.faction==="NEUTRAL")}function I(s,e){const t=e*60;s.objectiveText=`Продержитесь ${e} минут`,s.winCondition=i=>i.time>=t}function H(s,e,t){s.objectiveText=`Накопите ресурсы: ₽${e} и $${t}`,s.winCondition=i=>i.getEconomy().rubles>=e&&i.getEconomy().dollars>=t}const _={SBEU:{id:"SBEU",name:"Кампания СБЭУ",missions:[{id:"sbeu-1",name:"Инструктаж зверинца",faction:"SBEU",setup:s=>{s.spawnDemo(),s.objectiveText="Выделяйте юнитов и отдавайте приказы. Постройте пару бойцов",s.onUpdateExtra=(e,t)=>{},s.winCondition=e=>e.entities.filter(t=>t.faction==="SBEU"&&t.type==="unit").length>=10}},{id:"sbeu-2",name:"Отбить ресурсные точки",faction:"SBEU",setup:s=>{s.spawnDemo();for(const e of s.entities.filter(t=>t.type==="resource"))u(s,"PMС",{x:e.pos.x+6,y:e.pos.y+6},[{unitId:"pmc-typok",count:3}]);s.objectiveText="Очистите окрестности ресурсов",s.winCondition=e=>e.entities.every(t=>!(t.faction==="PMС"&&t.type==="unit"))}},{id:"sbeu-3",name:"Штурм укрепточки",faction:"SBEU",setup:s=>{s.spawnDemo(),u(s,"PMС",{x:92,y:86},[{unitId:"pmc-silach",count:3},{unitId:"pmc-sniper",count:2}]),S(s,"SBEU")}},{id:"sbeu-4",name:"Накопить на штурм",faction:"SBEU",setup:s=>{s.spawnDemo(),H(s,1e3,300);let e=0;s.onUpdateExtra=(t,i)=>{e+=i,e>20&&(e=0,u(t,"PMС",{x:88,y:92},[{unitId:"pmc-typok",count:4},{unitId:"pmc-grenade",count:1}]))}}},{id:"sbeu-5",name:"Штурм водоочистной",faction:"SBEU",setup:s=>{s.spawnDemo(),u(s,"PMС",{x:94,y:84},[{unitId:"pmc-silach",count:4},{unitId:"pmc-sniper",count:2},{unitId:"pmc-tank",count:1}]),S(s,"SBEU")}}]},PMC:{id:"PMC",name:"Кампания ЧВК",missions:[{id:"pmc-1",name:"Прибытие Зубешко",faction:"PMС",setup:s=>{s.spawnDemo(),s.objectiveText="Инструктаж по механикам ЧВК",s.winCondition=e=>e.entities.filter(t=>t.faction==="PMС"&&t.type==="unit").length>=8}},{id:"pmc-2",name:"Оборона укрепления A",faction:"PMС",setup:s=>{s.spawnDemo(),I(s,3);let e=0;s.onUpdateExtra=(t,i)=>{e+=i,e>15&&(e=0,u(t,"SBEU",{x:60,y:30},[{unitId:"sbeu-worm",count:6},{unitId:"sbeu-caterpillar",count:2}]))}}},{id:"pmc-3",name:"Оборона укрепления B",faction:"PMС",setup:s=>{s.spawnDemo(),I(s,4);let e=0;s.onUpdateExtra=(t,i)=>{e+=i,e>18&&(e=0,u(t,"SBEU",{x:66,y:52},[{unitId:"sbeu-cockroach",count:3},{unitId:"sbeu-cicada",count:2}]))}}},{id:"pmc-4",name:"Предательство Пуссильченко",faction:"PMС",setup:s=>{s.spawnDemo(),I(s,5);let e=0;s.onUpdateExtra=(t,i)=>{e+=i,e>20&&(e=0,u(t,"SBEU",{x:70,y:46},[{unitId:"sbeu-worm",count:6},{unitId:"sbeu-cockroach",count:4},{unitId:"sbeu-turtle",count:1}]))}}},{id:"pmc-5",name:"Контрнаступление",faction:"PMС",setup:s=>{s.spawnDemo(),S(s,"PMС")}}]}};function K(s,e){const i=_[s].missions[e],o=new $(128,128);return i.setup(o),o}const p=document.getElementById("game"),N=p.getContext("2d");function j(){const s=Math.max(1,Math.min(2,window.devicePixelRatio||1));p.width=Math.floor(window.innerWidth*s),p.height=Math.floor(window.innerHeight*s),p.style.width=`${window.innerWidth}px`,p.style.height=`${window.innerHeight}px`,N.setTransform(s,0,0,s,0,0)}j();window.addEventListener("resize",j);const M=new O(p,N);let g="SBEU",y=0;function U(){M.loadWorld(K(g,y))}U();let A=performance.now();function z(s){const e=Math.min(.05,(s-A)/1e3);A=s,M.update(e),M.render(),requestAnimationFrame(z)}requestAnimationFrame(z);const J=document.getElementById("rubles"),V=document.getElementById("dollars"),Z=document.getElementById("selected"),tt=document.getElementById("inspector"),T=document.getElementById("actions");function et(){const s=M.getUIState();J.textContent=String(s.rubles),V.textContent=String(s.dollars),Z.textContent=String(s.selectedCount),tt.textContent=s.inspector+(s.objective?` | Цель: ${s.objective}`:""),T.innerHTML="",L(`Кампания: ${g}`,()=>{g=g==="SBEU"?"PMC":"SBEU",y=0,U()}),L(`Миссия ${y+1}/5`,()=>{y=(y+1)%5,U()});for(const e of s.actions){const t=document.createElement("div");t.className="btn",t.textContent=`${e.label} (${e.costRubles}₽/${e.costDollars}$)`,t.onclick=()=>e.onClick(),T.appendChild(t)}}function L(s,e){const t=document.createElement("div");t.className="btn",t.textContent=s,t.onclick=e,T.appendChild(t)}setInterval(et,120);
